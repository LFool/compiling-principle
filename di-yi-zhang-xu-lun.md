# 第一章 绪论

## 1. 什么是编译

### 1.1 语言和编译

**机器语言：**计算机可以直接识别的语言，由0和1组成。例如：`C706 0000 0002`

**缺点：**不容易理解；不易编写；易错

**汇编语言：**引入了助记符。例如：`MOV X, 2`

**优点：**比较形象直观

**缺点：**依赖于特定的机器，不同的机器助记符不同，导致程序员必须记住相应机器的助记符；

编写效率低，一条简单的语句，也需要好几条指令

**高级语言：**类似于数学定义式或自然语言的简介形式。例如：`x = 2`

**优点：**接近人类的表达习惯；不依赖特定机器；编写效率高

最终，汇编语言和高级语言都要翻译成机器可以识别的机器语言

> 汇编语言 -&gt; 机器语言 （汇编）
>
> 高级语言 -&gt; 汇编语言/机器语言（编译）

**编译：将高级语言（源语言）翻译成汇编语言或机器语言（目标语言）的过程**

### 1.2 编译器的位置

![&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4F4D;&#x7F6E;](.gitbook/assets/image%20%281%29.png)

**预处理器：**把存储在不同文件中的源程序聚合在一起；把被称为宏的缩写语句转换成原始语句

**可重定位：**在内存中存放的起始位置L不是固定的，绝对地址 = 起始位置 + 相对地址

**加载器：**修改可重定位地址，将修改后的指令和数据放到内存中适当的位置

**链接器：**将多个可重定位的机器代码文件（包括库文件）连接到一起；解决外部内存地址的问题（一个文件可能会引用另一个文件中的数据对象或过程，这些数据对象或过程相对于这个文件来说就是外部内存地址）

## 2. 编译系统的结构

![&#x7F16;&#x8BD1;&#x7CFB;&#x7EDF;&#x7684;&#x7ED3;&#x6784;](.gitbook/assets/image%20%282%29.png)

## 3. 词法分析

**主要任务：**从左向右逐行扫描源程序的字符，识别出各个单词，确定单词的类型。将识别出的单词转换成同一的**机内表达** —— 词法单元（token）形式

**token：**&lt;种别码，属性值&gt;

<table>
  <thead>
    <tr>
      <th style="text-align:left"></th>
      <th style="text-align:left">&#x5355;&#x8BCD;&#x7C7B;&#x578B;</th>
      <th style="text-align:left">&#x79CD;&#x522B;</th>
      <th style="text-align:left">&#x79CD;&#x522B;&#x7801;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">1</td>
      <td style="text-align:left">&#x5173;&#x952E;&#x5B57;</td>
      <td style="text-align:left">program&#x3001;if&#x3001;else&#x3001;then&#x3001;...</td>
      <td style="text-align:left">&#x4E00;&#x8BCD;&#x4E00;&#x7801;</td>
    </tr>
    <tr>
      <td style="text-align:left">2</td>
      <td style="text-align:left">&#x6807;&#x8BC6;&#x7B26;</td>
      <td style="text-align:left">&#x53D8;&#x91CF;&#x540D;&#x3001;&#x6570;&#x7EC4;&#x540D;&#x3001;&#x8BB0;&#x5F55;&#x540D;&#x3001;&#x8FC7;&#x7A0B;&#x540D;&#x3001;...</td>
      <td
      style="text-align:left">&#x591A;&#x8BCD;&#x4E00;&#x7801;</td>
    </tr>
    <tr>
      <td style="text-align:left">3</td>
      <td style="text-align:left">&#x5E38;&#x91CF;</td>
      <td style="text-align:left">&#x6574;&#x578B;&#x3001;&#x6D6E;&#x70B9;&#x578B;&#x3001;&#x5B57;&#x7B26;&#x578B;&#x3001;&#x5E03;&#x5C14;&#x578B;&#x3001;...</td>
      <td
      style="text-align:left">&#x4E00;&#x578B;&#x4E00;&#x7801;</td>
    </tr>
    <tr>
      <td style="text-align:left">4</td>
      <td style="text-align:left">&#x8FD0;&#x7B97;&#x7B26;</td>
      <td style="text-align:left">
        <p>&#x7B97;&#x672F;&#xFF08;+ - * / ++ --&#xFF09;</p>
        <p>&#x5173;&#x7CFB;&#xFF08;&gt; &lt; == != &gt;= &lt;=&#xFF09;</p>
        <p>&#x903B;&#x8F91;&#xFF08;&amp; | ~&#xFF09;</p>
      </td>
      <td style="text-align:left">
        <p>&#x4E00;&#x8BCD;&#x4E00;&#x7801;</p>
        <p>&#x6216;</p>
        <p>&#x4E00;&#x578B;&#x4E00;&#x7801;</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">5</td>
      <td style="text-align:left">&#x754C;&#x9650;&#x7B26;</td>
      <td style="text-align:left">; ( ) = { } ...</td>
      <td style="text-align:left">&#x4E00;&#x8BCD;&#x4E00;&#x7801;</td>
    </tr>
  </tbody>
</table>

**例子：**

![](.gitbook/assets/image%20%283%29.png)

## 4. 语法分析

**语法分析器**从词法分析器输出的token序列中**识别出各类短语**，并**构造语法分析树**

**语法分析树**描述了句子的语法结构

![&#x8BED;&#x6CD5;&#x5206;&#x6790;&#x6811;](.gitbook/assets/image%20%284%29.png)

## 5. 语义分析

**主要任务：**

1. 收集标识符的属性信息
   * 种属（Kind）
     * 简单标量、复合变量（数组、记录、...）、过程、...
   * 类型（Type）
     * 整型、实型、字符型、布尔型、指针型、...
   * 存储位置、长度
   * 值
   * 作用域
   * 参数和返回值信息
     * 参数个数、参数类型、参数传递方式、返回值类型、...
2. 语义检查
   * 变量或过程**未经声明就使用**
   * 变量或过程名**重复声明**
   * **运算分量**类型不匹配
   * **操作符**与**操作数**之间的类型不匹配
     * **数组下标**不是整数
     * 对**非数组变量**使用数组访问操作符
     * 对**非过程名**使用过程调用操作符
     * 过程调用的**参数类型或数目**不匹配
     * 函数**返回类型**有误

## 6. 中间代码生成

### 6.1 常用的中间表示形式

* 三地址码
  * 三地址码由**类似于汇编语言**的指令序列组成，每个指令**最多有三个操作数**
* 语法结构树/语法树

### 6.2 常用的三地址指令

![&#x5E38;&#x7528;&#x7684;&#x4E09;&#x5730;&#x5740;&#x6307;&#x4EE4;](.gitbook/assets/image%20%285%29.png)

### 6.3 三地址指令的表示

* 四元式
  * （op, y, z, x）
* 三元式
* 间接三元式

### 6.4 三地址指令的四元式表示

![&#x4E09;&#x5730;&#x5740;&#x6307;&#x4EE4;&#x7684;&#x56DB;&#x5143;&#x5F0F;&#x8868;&#x793A;](.gitbook/assets/image%20%286%29.png)

### 6.5 中间代码生成的例子

![](.gitbook/assets/image%20%287%29.png)

## 7. 目标代码生成器

目标代码生成以源程序的**中间表示形式**作为输入，并把它映射到**目标语言**

目标代码生成的一个重要的任务是为程序使用的变量**合理分配寄存器**

## 8. 代码优化

为改进代码所进行的**等价程序变换**，使其**运行得更快**一些、**占用空间更少**一些，或者二者兼顾

